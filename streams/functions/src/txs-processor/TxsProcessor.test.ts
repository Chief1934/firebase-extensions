import { TxsProcessor } from './TxsProcessor';

const batch = {
  logs: [
    {
      logIndex: '43',
      transactionHash: '0xbe0deb85f7c6a31c017d6ce442bb019614b292c5db1d389eb745beeee28e561c',
      address: '0xd533a949740bb3306d119cc777fa900ba034cd52',
      data: '0x0000000000000000000000000000000000000000000006ff547102a1f5eaf000',
      topic0: '0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef',
      topic1: '0x000000000000000000000000dfd5293d8e347dfe59e90efd55b2956a1343963d',
      topic2: '0x00000000000000000000000083d4421afd3ca013d3a034679360e13c8c90ea49',
      topic3: null,
      tag: 'testetset',
      streamId: '1f5cc0d3-085e-4bcc-8c5f-c48952fd40f3',
      streamType: 'wallet',
    },
    {
      logIndex: '51',
      transactionHash: '0xe44974c3a9438655f2416aebf7851f2f7877a13140642ac1b425e036cfe169d8',
      address: '0xdac17f958d2ee523a2206206994597c13d831ec7',
      data: '0x0000000000000000000000000000000000000000000000000000000017d78400',
      topic0: '0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef',
      topic1: '0x000000000000000000000000dfd5293d8e347dfe59e90efd55b2956a1343963d',
      topic2: '0x000000000000000000000000c33c4803ab0c02039b547cafa00de01bb38a2668',
      topic3: null,
      tag: 'testetset',
      streamId: '1f5cc0d3-085e-4bcc-8c5f-c48952fd40f3',
      streamType: 'wallet',
    },
  ],
  txs: [
    {
      hash: '0xbe0deb85f7c6a31c017d6ce442bb019614b292c5db1d389eb745beeee28e561c',
      gas: '207128',
      gasPrice: '9438195072',
      nonce: '4262270',
      input:
        '0xa9059cbb00000000000000000000000083d4421afd3ca013d3a034679360e13c8c90ea490000000000000000000000000000000000000000000006ff547102a1f5eaf000',
      transactionIndex: '38',
      fromAddress: '0xdfd5293d8e347dfe59e90efd55b2956a1343963d',
      toAddress: '0xd533a949740bb3306d119cc777fa900ba034cd52',
      value: '0',
      type: '2',
      v: '1',
      r: '96249060018364285993123622530034015855396935543643928257393022173155950109230',
      s: '27600761087802763286576855017736153196108066199813102748650393371610275036008',
      receiptCumulativeGasUsed: '2330288',
      receiptGasUsed: '51349',
      receiptContractAddress: null,
      receiptRoot: null,
      receiptStatus: '1',
      tag: 'testetset',
      streamId: '1f5cc0d3-085e-4bcc-8c5f-c48952fd40f3',
      streamType: 'wallet',
    },
    {
      hash: '0xd40b1478a46c5e057fdcf9ce4e66cacdd051efd2eb785efcf258a140d6cecce8',
      gas: '207128',
      gasPrice: '9438195072',
      nonce: '4262271',
      input: '0x',
      transactionIndex: '40',
      fromAddress: '0xdfd5293d8e347dfe59e90efd55b2956a1343963d',
      toAddress: '0x22eef23d58355f08034551f66c194c2752d494c6',
      value: '379232000000000000',
      type: '2',
      v: '0',
      r: '69237207790765866696935971240527419315898838706172954209061790382535162301643',
      s: '30979082414978738022222258781190316906346472755382588749197469058508640339243',
      receiptCumulativeGasUsed: '2372288',
      receiptGasUsed: '21000',
      receiptContractAddress: null,
      receiptRoot: null,
      receiptStatus: '1',
      tag: 'testetset',
      streamId: '1f5cc0d3-085e-4bcc-8c5f-c48952fd40f3',
      streamType: 'wallet',
    },
    {
      hash: '0xe44974c3a9438655f2416aebf7851f2f7877a13140642ac1b425e036cfe169d8',
      gas: '207128',
      gasPrice: '9438195072',
      nonce: '4262272',
      input:
        '0xa9059cbb000000000000000000000000c33c4803ab0c02039b547cafa00de01bb38a26680000000000000000000000000000000000000000000000000000000017d78400',
      transactionIndex: '49',
      fromAddress: '0xdfd5293d8e347dfe59e90efd55b2956a1343963d',
      toAddress: '0xdac17f958d2ee523a2206206994597c13d831ec7',
      value: '0',
      type: '2',
      v: '1',
      r: '49179632417280830167072228164793879056220997289781496300047175631636590872030',
      s: '34490477605063936156564847967768090403589534575737296395583458325241335365549',
      receiptCumulativeGasUsed: '2857253',
      receiptGasUsed: '46097',
      receiptContractAddress: null,
      receiptRoot: null,
      receiptStatus: '1',
      tag: 'testetset',
      streamId: '1f5cc0d3-085e-4bcc-8c5f-c48952fd40f3',
      streamType: 'wallet',
    },
  ],
  txsInternal: [],
  chainId: '0x1',
  confirmed: true,
  abis: {},
  block: {
    number: '15667105',
    hash: '0x2edd5497299e7e49f0bdb054977f67224c0e942956bb974d3b10ee2a0ce1491f',
    timestamp: '1664793815',
  },
  retries: 0,
  erc20Transfers: [
    {
      transactionHash: '0xbe0deb85f7c6a31c017d6ce442bb019614b292c5db1d389eb745beeee28e561c',
      logIndex: '43',
      tag: 'testetset',
      tokenAddress: '0xd533a949740bb3306d119cc777fa900ba034cd52',
      from: '0xdfd5293d8e347dfe59e90efd55b2956a1343963d',
      to: '0x83d4421afd3ca013d3a034679360e13c8c90ea49',
      value: '33044203283480000000000',
      tokenName: 'Curve DAO Token',
      tokenSymbol: 'CRV',
      tokenDecimals: '18',
      valueWithDecimals: '33044.20328348',
    },
    {
      transactionHash: '0xe44974c3a9438655f2416aebf7851f2f7877a13140642ac1b425e036cfe169d8',
      logIndex: '51',
      tag: 'testetset',
      tokenAddress: '0xdac17f958d2ee523a2206206994597c13d831ec7',
      from: '0xdfd5293d8e347dfe59e90efd55b2956a1343963d',
      to: '0xc33c4803ab0c02039b547cafa00de01bb38a2668',
      value: '400000000',
      tokenName: 'Tether USD',
      tokenSymbol: 'USDT',
      tokenDecimals: '6',
      valueWithDecimals: '400',
    },
  ],
  erc20Approvals: [],
  nftApprovals: {
    ERC1155: [],
    ERC721: [],
  },
  nftTransfers: [],
};

describe('TxsProcessor', () => {
  it('builds correctly', () => {
    const processor = new TxsProcessor();

    const updates = processor.process(batch);

    expect(updates.length).toBe(3);
    expect(updates[0].tableName).toBe('Testetset');
  });
});
